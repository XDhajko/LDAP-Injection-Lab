{% extends "base.html" %}
{% block title %}E04 Blind AND{% endblock %}
{% block content %}

<style>
  .edge-pad thead th:first-child,
  .edge-pad tbody td:first-child { padding-left: 1rem; }
  .edge-pad thead th:last-child,
  .edge-pad tbody td:last-child { padding-right: 1rem; }
</style>

<div class="card shadow-sm">
  <div class="card-header d-flex justify-content-between align-items-center">
    <strong>Group Membership</strong>
    <form id="groupDeptForm" method="get" class="d-flex gap-2">
      <select name="group" id="groupSelect" class="form-select form-select-sm" style="width: 240px;">
        {% for g in groups %}
          <option value="{{ g }}" {% if g == selected_group %}selected{% endif %}>{{ g }}</option>
        {% endfor %}
      </select>
      <select name="dept" id="deptSelect" class="form-select form-select-sm" style="width: 180px;">
        <option value="" {% if not selected_dept %}selected{% endif %}>All Departments</option>
        {% for d in departments %}
          <option value="{{ d }}" {% if d == selected_dept %}selected{% endif %}>{{ d }}</option>
        {% endfor %}
      </select>
      <noscript><button class="btn btn-sm btn-primary">Load</button></noscript>
    </form>
  </div>

  <div class="card-body p-0">
    {% if error %}
      <div class="alert alert-warning m-3 mb-0">
        <strong>Notice:</strong> {{ error }}
        {% if not members %}<br><small>No members listed.</small>{% endif %}
      </div>
    {% endif %}

    <div class="table-responsive">
      <table class="table table-sm mb-0 edge-pad" style="--bs-table-cell-padding-x: 1rem;">
        <thead class="table-light">
          <tr>
            <th>Name (cn)</th>
            <th>Mail</th>
            <th>Telephone</th>
          </tr>
        </thead>
        <tbody>
          {% for m in members %}
            <tr>
              <td>{{ m.cn }}</td>
              <td>{{ m.mail }}</td>
              <td>{{ m.telephoneNumber }}</td>
            </tr>
          {% empty %}
            <tr><td colspan="3" class="text-center py-4">No members found for this selection.</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <div class="card-footer d-flex justify-content-between align-items-center">
    <div>Members: <strong>{{ count }}</strong></div>
    <div class="text-muted small">
      Group: {{ selected_group }}
      {% if group_dn %} &middot; <code>{{ group_dn }}</code>{% endif %}
      {% if selected_dept %} &middot; Dept: {{ selected_dept }}{% else %} &middot; Dept: ALL{% endif %}
    </div>
  </div>
</div>

<script>
  (function() {
    const g = document.getElementById('groupSelect');
    const d = document.getElementById('deptSelect');
    const f = document.getElementById('groupDeptForm');
    g.addEventListener('change', function() {
      // reset dept to ALL when group changes
      d.value = '';
      f.submit();
    });
    d.addEventListener('change', function() {
      f.submit();
    });
  })();
</script>

{% endblock %}
